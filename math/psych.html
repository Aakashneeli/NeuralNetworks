<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Chosen Palette: Calm Harmony -->
    <!-- Application Structure Plan: The SPA is structured as a task-oriented guide, not a linear report. The primary user goal—finding a specialist—is addressed immediately with an interactive filtering tool at the top. This replaces the static narrative recommendations and makes the app instantly useful. Provider profiles are presented in a dynamic card grid that responds to these filters, with details available in modals to prevent clutter. Educational content (about professional roles and therapies) is organized into an accordion for easy consumption. Practical information (costs, booking) is grouped into a dedicated section. This architecture prioritizes user action and decision-making over passive reading, making the dense report content accessible and explorable. -->
    <!-- Visualization & Content Choices: Provider profiles are interactive cards for quick scanning and filtering. A modal displays full details on demand. Educational text is in an accordion to manage complexity. A Chart.js bar chart visualizes cost ranges, making financial data easier to compare than text. An HTML table is used for the direct comparison of providers. All choices avoid SVG/Mermaid and focus on interactive, canvas-based, or structured HTML solutions to enhance user engagement and understanding. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <title>Find Mental Health Support in Kathmandu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;620;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F8F7F4;
            color: #3D405B;
        }
        .accent-color { color: #5A9A9A; }
        .bg-accent-color { background-color: #5A9A9A; }
        .bg-accent-color-light { background-color: #E0ECEB; }
        .border-accent-color { border-color: #5A9A9A; }
        .nav-link {
            transition: color 0.3s;
        }
        .nav-link:hover {
            color: #5A9A9A;
        }
        .filter-btn {
            transition: all 0.3s;
        }
        .filter-btn.active {
            background-color: #5A9A9A;
            color: white;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .provider-card {
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .provider-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out, padding 0.5s ease-in-out;
        }
        .accordion-item.active .accordion-content {
            max-height: 1000px; /* Adjust as needed */
        }
        .accordion-item.active .accordion-arrow {
            transform: rotate(180deg);
        }
        .modal {
            display: none;
        }
        .modal-content {
            animation: slide-up 0.4s ease-out;
        }
        @keyframes slide-up {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .gemini-feature {
            border-top: 1px solid #e5e7eb;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
        }
        .gemini-output {
            background-color: #f8fafc;
            border-left: 3px solid #5A9A9A;
            padding: 1rem;
            border-radius: 0.25rem;
            margin-top: 1rem;
            font-size: 0.9rem;
        }
        .loader {
            text-align: center;
            padding: 1rem;
            font-style: italic;
            color: #6b7280;
        }
    </style>
</head>
<body class="antialiased">

    <!-- Header & Nav -->
    <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-40 shadow-sm">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="text-xl font-bold tracking-tight">Kathmandu Mental Health Guide</div>
            <div class="hidden md:flex items-center space-x-8 text-sm font-medium">
                <a href="#finder" class="nav-link">Find a Specialist</a>
                <a href="#learn" class="nav-link">Learn More</a>
                <a href="#logistics" class="nav-link">Practical Info</a>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-6 py-12">

        <!-- Hero Section -->
        <section class="text-center mb-16">
            <h1 class="text-4xl md:text-5xl font-bold tracking-tighter mb-4">Find the Right Mental Health Support</h1>
            <p class="text-lg md:text-xl text-gray-600 max-w-3xl mx-auto">An interactive guide to help you find a specialist in Kathmandu for anger management and negative thinking.</p>
        </section>

        <!-- Specialist Finder -->
        <section id="finder" class="mb-16 scroll-mt-20">
            <div class="bg-white p-6 md:p-8 rounded-xl shadow-md">
                <h2 class="text-2xl font-bold mb-2">Find a Specialist Based on Your Needs</h2>
                <p class="text-gray-600 mb-6">This report identified several highly recommended professionals. Use the filters below to find the best fit for you. Selections are based on the detailed recommendations in the source report.</p>
                <div id="filters" class="flex flex-wrap gap-3 mb-8">
                    <button data-filter="all" class="filter-btn active px-4 py-2 bg-gray-100 text-gray-700 rounded-full text-sm font-medium">Show All</button>
                    <button data-filter="anger-specialist" class="filter-btn px-4 py-2 bg-gray-100 text-gray-700 rounded-full text-sm font-medium">Anger Management Focus</button>
                    <button data-filter="female-doctor" class="filter-btn px-4 py-2 bg-gray-100 text-gray-700 rounded-full text-sm font-medium">Female Doctor Preferred</button>
                    <button data-filter="creative-therapy" class="filter-btn px-4 py-2 bg-gray-100 text-gray-700 rounded-full text-sm font-medium">Creative / Arts Therapy</button>
                    <button data-filter="top-rated" class="filter-btn px-4 py-2 bg-gray-100 text-gray-700 rounded-full text-sm font-medium">Top Patient Reviews</button>
                    <button data-filter="institutional" class="filter-btn px-4 py-2 bg-gray-100 text-gray-700 rounded-full text-sm font-medium">Full-Service Hospital</button>
                </div>
                <div id="provider-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Provider cards will be injected here by JS -->
                </div>
            </div>
        </section>

        <!-- Learn More Section -->
        <section id="learn" class="mb-16 scroll-mt-20">
            <h2 class="text-3xl font-bold text-center mb-8">Understanding Your Options</h2>
            <div class="grid md:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-xl shadow-md">
                    <h3 class="text-xl font-bold mb-4">Professional Roles in Nepal</h3>
                    <div id="roles-accordion" class="space-y-3"></div>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-md">
                    <h3 class="text-xl font-bold mb-4">Effective Therapeutic Approaches</h3>
                    <div id="therapies-accordion" class="space-y-3"></div>
                    <div class="gemini-feature">
                         <h4 class="font-bold text-gray-800 mb-2">✨ Understand My Feelings with CBT</h4>
                         <p class="text-sm text-gray-600 mb-4">Describe a recent situation that made you feel angry or negative. This tool will use AI to show you how CBT might analyze it. This is for educational purposes only.</p>
                         <textarea id="cbt-input" class="w-full p-2 border border-gray-300 rounded-md text-sm" rows="3" placeholder="e.g., I got into an argument with my mom because she criticized my job."></textarea>
                         <button id="cbt-analyze-btn" class="mt-2 w-full text-center bg-accent-color text-white text-sm font-medium py-2 px-4 rounded-md hover:bg-opacity-90 transition-colors">Analyze with CBT Principles</button>
                         <div id="cbt-output" class="mt-4"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Practical Info Section -->
        <section id="logistics" class="scroll-mt-20">
            <h2 class="text-3xl font-bold text-center mb-8">Practical Information</h2>
            <div class="grid md:grid-cols-5 gap-8">
                <div class="md:col-span-3 bg-white p-6 rounded-xl shadow-md">
                    <h3 class="text-xl font-bold mb-4">Cost of Care in Kathmandu</h3>
                    <p class="text-gray-600 mb-6">Costs vary by professional and setting. This chart shows typical ranges for consultations vs. full therapy sessions. All prices are in Nepalese Rupees (NPR).</p>
                    <div class="chart-container relative h-64 md:h-80 w-full max-w-lg mx-auto">
                        <canvas id="costChart"></canvas>
                    </div>
                </div>
                <div class="md:col-span-2 bg-white p-6 rounded-xl shadow-md">
                    <h3 class="text-xl font-bold mb-4">Booking an Appointment</h3>
                    <p class="text-gray-600 mb-4">Contacting a clinic is the first step. Here is a sample script:</p>
                    <div class="bg-accent-color-light p-4 rounded-lg text-sm text-gray-700 italic mb-6">
                        "Hello, I would like to book a new patient consultation for a 27-year-old female seeking help with anger management and counseling."
                    </div>
                    <h4 class="font-bold mb-2">Online Platforms</h4>
                    <p class="text-gray-600 mb-4">Tele-health is a flexible option. Consider these platforms for online care:</p>
                    <ul class="space-y-2 text-sm">
                        <li class="p-3 bg-gray-50 rounded-md"><strong>Mankaa Kura:</strong> Leading affordable online counseling in Nepal.</li>
                        <li class="p-3 bg-gray-50 rounded-md"><strong>Manobhavana:</strong> Professional platform led by a PhD-level expert.</li>
                        <li class="p-3 bg-gray-50 rounded-md"><strong>TalktoAngel:</strong> International platform offering therapy and online psychiatric consultations.</li>
                    </ul>
                </div>
            </div>
        </section>
    </main>

    <!-- Modal -->
    <div id="provider-modal" class="modal fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center p-4">
        <div class="modal-content bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <!-- Modal content injected by JS -->
        </div>
    </div>

<script>
const DB = {
    providers: [
        { id: 1, name: "Dr. Purushottam Adhikari", clinic: "Mind Clinic", type: "Psychiatrist (Hybrid)", tags: ["anger-specialist", "top-rated"], differentiator: "Explicit focus and published content on anger management.", profile: { credentials: "MD in Psychiatry and Mental Health. His private practice, Mind Clinic, explicitly lists 'Stress and anger management' as a core service. His expertise is further demonstrated by his authorship of a detailed article titled 'Anger Management Counseling in Kathmandu'.", style: "Combines pharmacotherapy with psychotherapy, specifically utilizing Cognitive Behavioral Therapy (CBT) and teaching relaxation exercises. Patient testimonials confirm this integrated approach, with one client noting that he 'does not just prescribe the medicine and gives time to listen to the problem'.", logistics: "Located in Raniban, Kathmandu. Offers both in-person and online consultations. Appointments can be booked via Phone/WhatsApp.", contact: { phone: "9841066077", email: "puru.ad12@gmail.com" } } },
        { id: 2, name: "Dr. Richa Amatya", clinic: "Nepal Mediciti", type: "Psychiatrist (Hybrid)", tags: ["female-doctor", "anger-specialist"], differentiator: "Top female psychiatrist with advanced TEAM-CBT certification.", profile: { credentials: "Associate Consultant Psychiatrist with an MD in Psychiatry, practicing at Nepal Mediciti hospital. She is a certified TEAM-CBT therapist, an advanced and structured form of CBT.", style: "Her use of TEAM-CBT suggests a commitment to measurable outcomes and a strong patient-centered framework. She has given public talks on 'Cognitive Clarity,' demonstrating her expertise in teaching patients practical, CBT-based tools to manage intrusive thoughts and anxiety.", logistics: "Based at Nepal Mediciti in Nakhu, Lalitpur. Appointments are managed through the hospital's central system.", contact: { phone: "+977-01-4217766", email: "N/A" } } },
        { id: 3, name: "Dr. Kenison Shrestha", clinic: "Mental Health Clinic", type: "Psychiatrist (Hybrid)", tags: ["top-rated"], differentiator: "Exceptional patient reviews and high accessibility.", profile: { credentials: "MD in Psychiatry from the prestigious Institute of Medicine (IOM, TUTH). His clinic's team is trained in a variety of evidence-based treatment modalities, including CBT and DBT.", style: "Emphasizes a 'holistic,' 'personalized,' and 'collaborative' approach to care. He works closely with patients to develop customized treatment plans. His clinic offers a full suite of services, including psychiatric evaluations, medication management, and therapy.", logistics: "Highly accessible, with operations at multiple clinics in Lalitpur (Karunya Health Care, Expert Clinic). Several contact numbers available for booking.", contact: { phone: "9851096229", email: "N/A" } } },
        { id: 4, name: "Dr. Yujal Man Singh", clinic: "Mind Matters Nepal", type: "Psychiatrist (Hybrid)", tags: ["anger-specialist"], differentiator: "Direct match: Anger specialty + high-level CBT certification.", profile: { credentials: "A licensed psychiatrist and a certified Level 3 TEAM-CBT therapist. His professional profile explicitly lists 'Anger Management' as one of his core specialties.", style: "His practice integrates modern psychiatric medicine with advanced psychotherapy techniques like TEAM-CBT. The stated goal is to empower patients with tools for long-term healing and emotional resilience.", logistics: "His clinic, Mind Matters Nepal, is located in Kathmandu. He is directly reachable for appointments via phone or email.", contact: { phone: "+977-9851325591", email: "yujs1200@gmail.com" } } },
        { id: 5, name: "Atman Healing Center", clinic: "Sadhana Thapa", type: "Holistic Center", tags: ["creative-therapy"], differentiator: "Best for patients resistant to traditional talk therapy.", profile: { credentials: "A holistic center combining medical psychiatry with psychotherapy. Sadhana Thapa holds a Master's degree in Expressive Arts Therapy from Switzerland.", style: "A patient testimonial highlights success with anger issues through non-confrontational, creative methods like art therapy, which 'allowed me to open up and begin healing.' This is a powerful option for those who struggle to articulate feelings verbally.", logistics: "Located at Tilaganga B Marg, Kathmandu. Offers a full spectrum of services, including online consultations. Appointments can be scheduled by phone, email, or website form.", contact: { phone: "9862684909", email: "info@atmanhealing.com" } } },
        { id: 6, name: "Rhythm Neuropsychiatry Hospital", clinic: "Rhythm Hospital", type: "Institution", tags: ["institutional"], differentiator: "Full-service hospital for complex or severe cases.", profile: { credentials: "A specialized 25-bed neuropsychiatry hospital, regarded as one of the top psychiatric facilities in Nepal. Staffed by a large, multidisciplinary team of senior consultant psychiatrists and clinical psychologists.", style: "Offers a complete spectrum of mental health services, including outpatient consultations, psychological counseling (CBT confirmed in reviews), inpatient services for acute stabilization, and advanced medical treatments if required.", logistics: "Two locations in Kathmandu: the main facility in Aloknagar, Minbhawan, and a branch in Maharajgunj.", contact: { phone: "01-545-0977", email: "N/A" } } }
    ],
    roles: [
        { title: "Psychiatrist: The Medical Doctor", content: "A medical doctor (MD) specializing in mental health. They can diagnose conditions and are uniquely qualified to prescribe medication. Best for managing the biological aspects of mental illness." },
        { title: "Clinical Psychologist: The Therapy Architect", content: "Holds an advanced degree (e.g., M.Phil, Ph.D.) in psychology. They are experts in psychotherapy ('talk therapy') and psychological assessment but do not prescribe medication." },
        { title: "Counselor/Therapist: The Supportive Guide", content: "A broader term for professionals who provide talk therapy, often with a Master's degree. They help clients navigate life challenges, manage stress, and work on personal growth." },
        { title: "Integrated Care: A Modern Approach", content: "A positive development in Kathmandu is psychiatrists who are also trained psychotherapists. They offer both medication and talk therapy, providing streamlined, holistic care." }
    ],
    therapies: [
        { title: "Cognitive Behavioral Therapy (CBT)", content: "The most recommended approach for anger and negative thinking. It's a skills-based therapy that helps you identify, challenge, and change unhelpful thought patterns and behaviors." },
        { title: "The CBT Toolkit", content: "Includes techniques like Cognitive Restructuring (reframing thoughts), journaling to identify triggers, learning emotional regulation skills (e.g., deep breathing), and assertiveness training." },
        { title: "TEAM-CBT: An Advanced Framework", content: "A highly structured form of CBT focusing on Testing, Empathy, Agenda Setting, and Methods. Several specialists in Kathmandu are certified in this advanced, patient-centric model." },
        { title: "Expressive Arts Therapy: A Creative Path", content: "Uses creative processes like drawing, painting, or movement to help explore and process complex emotions. A powerful alternative for those who find it difficult to talk about their feelings." }
    ]
};

document.addEventListener('DOMContentLoaded', () => {
    const providerGrid = document.getElementById('provider-grid');
    const filters = document.getElementById('filters');
    const modal = document.getElementById('provider-modal');
    const cbtAnalyzeBtn = document.getElementById('cbt-analyze-btn');
    const cbtInput = document.getElementById('cbt-input');
    const cbtOutput = document.getElementById('cbt-output');

    async function callGemini(prompt) {
        const apiKey = ""; 
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
        
        try {
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
            });
            if (!response.ok) {
                throw new Error(`API call failed with status: ${response.status}`);
            }
            const data = await response.json();
            if (data.candidates && data.candidates.length > 0) {
                return data.candidates[0].content.parts[0].text;
            }
            return "Sorry, I couldn't generate a response right now.";
        } catch (error) {
            console.error("Gemini API call error:", error);
            return "An error occurred while trying to get a response. Please try again later.";
        }
    }

    function renderProviders(filter = 'all') {
        providerGrid.innerHTML = '';
        const filteredProviders = filter === 'all' 
            ? DB.providers 
            : DB.providers.filter(p => p.tags.includes(filter));

        if (filteredProviders.length === 0) {
            providerGrid.innerHTML = `<p class="text-gray-500 md:col-span-3 text-center">No providers match this filter.</p>`;
            return;
        }
        
        filteredProviders.forEach(provider => {
            const card = document.createElement('div');
            card.className = 'provider-card bg-white rounded-lg shadow-sm overflow-hidden flex flex-col';
            card.innerHTML = `
                <div class="p-6 flex-grow">
                    <h3 class="text-xl font-bold mb-1">${provider.name}</h3>
                    <p class="text-sm text-gray-500 mb-3">${provider.clinic}</p>
                    <p class="text-sm text-gray-600 mb-4"><strong>Key Feature:</strong> ${provider.differentiator}</p>
                </div>
                <div class="bg-gray-50 p-4 border-t border-gray-200">
                    <button data-id="${provider.id}" class="view-details-btn w-full text-center bg-accent-color text-white text-sm font-medium py-2 px-4 rounded-md hover:bg-opacity-90 transition-colors">View Details</button>
                </div>
            `;
            providerGrid.appendChild(card);
        });
    }

    function openModal(providerId) {
        const provider = DB.providers.find(p => p.id == providerId);
        if (!provider) return;

        modal.innerHTML = `
            <div class="modal-content bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
                <div class="p-6 md:p-8">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h2 class="text-2xl md:text-3xl font-bold">${provider.name}</h2>
                            <p class="text-gray-500">${provider.clinic}</p>
                        </div>
                        <button id="close-modal-btn" class="text-gray-400 hover:text-gray-700 text-3xl leading-none">&times;</button>
                    </div>
                    <div class="space-y-6 text-gray-700">
                        <div><h4 class="font-bold text-gray-800">Credentials & Specialization</h4><p>${provider.profile.credentials}</p></div>
                        <div><h4 class="font-bold text-gray-800">Therapeutic Style</h4><p>${provider.profile.style}</p></div>
                        <div><h4 class="font-bold text-gray-800">Logistics</h4><p>${provider.profile.logistics}</p></div>
                        <div class="bg-accent-color-light p-4 rounded-lg">
                            <h4 class="font-bold text-gray-800 mb-2">Contact Information</h4>
                            <p><strong>Phone:</strong> ${provider.profile.contact.phone}</p>
                            <p><strong>Email:</strong> ${provider.profile.contact.email}</p>
                        </div>
                        <div class="gemini-feature">
                             <h4 class="font-bold text-gray-800 mb-2">✨ Prepare for Your First Session</h4>
                             <p class="text-sm text-gray-600 mb-4">Feeling nervous? Enter a few keywords about how you're feeling, and this AI tool will help you organize your thoughts for your first appointment.</p>
                             <input type="text" id="prepare-input" class="w-full p-2 border border-gray-300 rounded-md text-sm" placeholder="e.g., angry, sad, can't sleep">
                             <button id="prepare-btn" class="mt-2 w-full text-center bg-accent-color text-white text-sm font-medium py-2 px-4 rounded-md hover:bg-opacity-90 transition-colors">Help Me Prepare</button>
                             <div id="prepare-output" class="mt-4"></div>
                        </div>
                    </div>
                </div>
            </div>
        `;
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';

        document.getElementById('close-modal-btn').addEventListener('click', () => {
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
        });
        
        document.getElementById('prepare-btn').addEventListener('click', async () => {
            const input = document.getElementById('prepare-input').value;
            const outputDiv = document.getElementById('prepare-output');
            if (!input.trim()) {
                outputDiv.innerHTML = `<p class="text-red-500 text-sm">Please enter a few words about how you're feeling.</p>`;
                return;
            }
            outputDiv.innerHTML = `<div class="loader">✨ Thinking... please wait.</div>`;
            const prompt = `I am preparing for my first therapy session. I am feeling these things: "${input}". Please help me structure my thoughts. Generate a short, bulleted list of points I can discuss with my therapist to explain how I'm feeling. Write it in a supportive and encouraging tone, from the perspective of a helpful guide. Keep it concise, easy to read, and start with a brief encouraging sentence. Do not give medical advice.`;
            const result = await callGemini(prompt);
            outputDiv.innerHTML = `<div class="gemini-output">${result.replace(/\n/g, '<br>')}</div>`;
        });
    }

    filters.addEventListener('click', (e) => {
        if (e.target.tagName === 'BUTTON') {
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            e.target.classList.add('active');
            renderProviders(e.target.dataset.filter);
        }
    });

    providerGrid.addEventListener('click', (e) => {
        if (e.target.classList.contains('view-details-btn')) {
            openModal(e.target.dataset.id);
        }
    });
    
    modal.addEventListener('click', (e) => {
        if (e.target.id === 'provider-modal') {
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }
    });

    cbtAnalyzeBtn.addEventListener('click', async () => {
        const situation = cbtInput.value;
        if (!situation.trim()) {
            cbtOutput.innerHTML = `<p class="text-red-500 text-sm">Please describe a situation first.</p>`;
            return;
        }
        cbtOutput.innerHTML = `<div class="loader">✨ Analyzing... please wait.</div>`;
        const prompt = `Based on Cognitive Behavioral Therapy (CBT), analyze the following situation from a neutral, educational perspective: "${situation}". Identify a potential 'Activating Event,' a possible 'Belief' or thought pattern, and the likely 'Consequence' (the feeling of anger/negativity). Then, suggest one alternative thought to consider. Frame this as a simple educational example of the A-B-C model of CBT. Start with a sentence like "Here's one way to look at that situation using CBT principles:". Do not give medical advice, and include a disclaimer at the end that this is a simplified educational tool, not a diagnosis.`;
        const result = await callGemini(prompt);
        cbtOutput.innerHTML = `<div class="gemini-output">${result.replace(/\n/g, '<br>')}</div>`;
    });

    function createAccordion(containerId, data) {
        const container = document.getElementById(containerId);
        data.forEach(item => {
            const el = document.createElement('div');
            el.className = 'accordion-item bg-gray-50 rounded-lg border border-gray-200';
            el.innerHTML = `
                <button class="accordion-header w-full flex justify-between items-center text-left p-4">
                    <span class="font-medium text-sm">${item.title}</span>
                    <span class="accordion-arrow transition-transform duration-300">&#9660;</span>
                </button>
                <div class="accordion-content px-4 pb-0 text-sm text-gray-600">
                    <p class="py-4 border-t border-gray-200">${item.content}</p>
                </div>
            `;
            container.appendChild(el);
        });
        
        container.addEventListener('click', e => {
            const header = e.target.closest('.accordion-header');
            if (header) {
                const item = header.parentElement;
                item.classList.toggle('active');
            }
        });
    }
    
    createAccordion('roles-accordion', DB.roles);
    createAccordion('therapies-accordion', DB.therapies);

    const ctx = document.getElementById('costChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Psychiatric Consultation', 'Psychotherapy Session'],
            datasets: [{
                label: 'Cost in NPR',
                data: [1250, 2500],
                backgroundColor: ['rgba(90, 154, 154, 0.6)', 'rgba(61, 64, 91, 0.6)'],
                borderColor: ['rgb(90, 154, 154)', 'rgb(61, 64, 91)'],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            let label = context.dataset.label || '';
                            if (label) { label += ': '; }
                            if (context.parsed.y !== null) {
                                const ranges = {
                                    'Psychiatric Consultation': 'NPR 630 - 1,250',
                                    'Psychotherapy Session': 'NPR 1,000 - 2,500'
                                };
                                label += ranges[context.label];
                            }
                            return label;
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) { return 'NPR ' + value; }
                    }
                }
            }
        }
    });

    renderProviders();
});
</script>

</body>
</html>